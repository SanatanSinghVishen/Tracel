# TRACEL

TRACEL is a small, event-driven system that simulates “network packets”, optionally scores them with a Python AI service, and streams them live to a SOC-style dashboard.

It’s organized as three apps:

- `dashboard/` (React + Vite + Tailwind): the UI.
- `server/` (Node + Express + Socket.IO): traffic simulation + APIs + realtime streaming.
- `ai-engine/` (Python): the `/predict` endpoint used by the simulator (optional).

## Quick Start (recommended)

This repo includes a root starter so you don’t have to open two terminals manually.

1. Install dependencies for dashboard + server:

```bash
npm run install:all
```

2. Start dashboard + server together:

```bash
npm run dev
```

3. Open the dashboard:

- `http://localhost:5173/` (Vite will use another port if busy)

### Default Ports

- Dashboard (Vite): `http://localhost:5173/`
- Server (Express + Socket.IO): `http://localhost:3001/`
- AI engine (optional): `http://127.0.0.1:5000/`

## What Runs Where

### Dashboard (`dashboard/`)

- Live views: globe, charts, forensics, settings, etc.
- Connects to the server using Socket.IO.
- Uses Clerk on the frontend (publishable key is required for auth flows).

### Server (`server/`)

- Generates a continuous stream of simulated packets.
- Emits packets to connected clients via Socket.IO.
- Serves REST endpoints used by the UI (e.g. packets, threat intel, chat).
- Optional MongoDB persistence (it will still work without Mongo).

### AI Engine (`ai-engine/`) (optional)

- Exposes `POST /predict` used by the simulator.
- If it’s not running, the server will still stream packets, but AI scoring will be degraded (safe defaults).

## Repository Layout

- `dashboard/`
  - `src/` – React app
  - `.env.example` – environment template
- `server/`
  - `index.js` – Express/Socket.IO app
  - `traffic_simulator.js` – traffic generator + AI call
  - `models/Packet.js` – Mongoose model
  - `.env.example` – environment template
- `ai-engine/`
  - `train_model.py` – trains and writes `model.pkl`
  - `app.py` – Python API
  - `requirements.txt`

## Setup: Environment Variables

### Dashboard env (`dashboard/.env.local` recommended)

Copy `dashboard/.env.example` to `dashboard/.env.local`:

```env
VITE_SERVER_URL=http://localhost:3001
VITE_CLERK_PUBLISHABLE_KEY=pk_...
VITE_ADMIN_EMAIL=admin@example.com
```

Notes:

- `VITE_SERVER_URL` must match the server port.
- `VITE_ADMIN_EMAIL` is a simple UI-side admin toggle (used to hide/show admin-only UI).

### Server env (`server/.env`)

Copy `server/.env.example` to `server/.env`:

```env
MONGO_URL=mongodb://localhost:27017/tracel
AI_PREDICT_URL=http://127.0.0.1:5000/predict

GROQ_API_KEY=...
GROQ_MODEL=llama-3.1-8b-instant

ADMIN_EMAIL=admin@example.com
ADMIN_USER_ID=

TRACEL_LOG_LEVEL=info
PORT=3001
```

Notes:

- If `MONGO_URL` is missing, the server runs “memory-only” (no persistence) but the dashboard still works.
- `ADMIN_EMAIL`/`ADMIN_USER_ID` controls server-side admin-only endpoints.
- `TRACEL_LOG_LEVEL` can be `debug`, `info`, `warn`, or `error`.

### AI engine env (`ai-engine/`)

The AI engine runs with Python + `requirements.txt`. It reads `model.pkl` (generated by training).

## Running Each App Separately (manual)

### 1) Server

```bash
cd server
npm install
npm run dev
```

Server: `http://localhost:3001/`

### 2) Dashboard

```bash
cd dashboard
npm install
npm run dev
```

Dashboard: `http://localhost:5173/`

### 3) AI engine (optional)

```bash
cd ai-engine

python -m venv venv

# PowerShell
./venv/Scripts/Activate.ps1

pip install -r requirements.txt

# train once (creates/updates model.pkl)
python train_model.py

python app.py
```

AI engine: `http://127.0.0.1:5000/`

## Root Scripts

From the repo root:

- `npm run install:all` — installs dashboard + server deps.
- `npm run dev` — runs dashboard + server together.
- `npm run dev:dashboard` — dashboard only.
- `npm run dev:server` — server only.
- `npm run lint` — dashboard ESLint.
- `npm run build` — dashboard production build.

## VS Code Tasks

Use “Run Task” in VS Code:

- `dev: all`
- `dev: dashboard`
- `dev: server`

## Troubleshooting

### “Port already in use” (EADDRINUSE)

- Server uses port `3001` (configurable via `PORT`).
- Dashboard uses port `5173` (Vite will automatically pick `5174`, `5175`, etc.).

On Windows PowerShell you can find and kill by port:

```powershell
Get-NetTCPConnection -LocalPort 3001 | Select-Object -ExpandProperty OwningProcess -Unique
Stop-Process -Id <PID> -Force
```

### Dashboard shows “no data” / not connecting

- Confirm the server is running.
- Confirm `VITE_SERVER_URL` matches the server URL and port.
- Check the browser console and the server terminal output.

### MongoDB errors

- If you don’t want Mongo at all, remove `MONGO_URL` from `server/.env`.
- If using MongoDB Atlas, ensure your IP is whitelisted and credentials are correct.

### AI engine offline

- If `AI_PREDICT_URL` points to a non-running service, the server still streams packets, but AI scoring is reduced.

## Clean Reset (common)

If you deleted `node_modules` or dependencies got corrupted:

```bash
npm run install:all
npm run dev
```
